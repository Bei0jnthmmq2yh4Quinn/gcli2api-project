services:
  # 这是你的 API 服务
  - type: web
    name: gcli2api
    env: docker
    plan: free
    healthCheckPath: /
    dockerfilePath: ./Dockerfile
    envVars:
      - key: database__client
        value: mysql
      - key: database__connection__host
        fromService:
          type: pserv
          name: db
          property: host
      - key: database__connection__user
        fromService:
          type: pserv
          name: db
          # 修正1：将 'user' 改为 'MYSQL_USER'
          property: MYSQL_USER
      - key: database__connection__password
        fromService:
          type: pserv
          name: db
          # 修正2：将 'password' 改为 'MYSQL_PASSWORD'
          property: MYSQL_PASSWORD
      - key: database__connection__database
        fromService:
          type: pserv
          name: db
          # 修正3：将 'database' 改为 'MYSQL_DATABASE'
          property: MYSQL_DATABASE
      - key: url
        value: https://${RENDER_EXTERNAL_HOSTNAME}

  # 这是你的数据库服务
  - type: pserv
    name: db
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile.db
    # 修正4：将整个 'disk' 部分删除，以符合免费套餐要求
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        generateValue: true
      - key: MYSQL_USER
        generateValue: true
      - key: MYSQL_PASSWORD
        generateValue: true
      - key: MYSQL_DATABASE
        generateValue: true

